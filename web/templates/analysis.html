{% extends "base.html" %}
{% block content %}
<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-body">
                <h2 class="card-title">ECM Analysis Dashboard</h2>
                <p class="card-text">Comprehensive framework analysis and learning unit evaluation.</p>
                
                <button id="run-analysis" class="btn btn-primary" onclick="runAnalysis()">
                    <i class="fas fa-play"></i> Run Comprehensive Analysis
                </button>
                
                <div id="analysis-progress" class="mt-3" style="display: none;">
                    <div class="alert alert-info">
                        <i class="fas fa-spinner fa-spin"></i> Running analysis... This may take 5-6 minutes.
                    </div>
                </div>
                
                <div id="analysis-results" class="mt-3"></div>
            </div>
        </div>
    </div>
    <div class="col-lg-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Analysis Features</h5>
                <ul>
                    <li>90 learning units analysis</li>
                    <li>7 international frameworks</li>
                    <li>Versatility classification</li>
                    <li>Quality scoring</li>
                    <li>Comprehensive visualizations</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
function runAnalysis() {
    const button = document.getElementById('run-analysis');
    const progress = document.getElementById('analysis-progress');
    const results = document.getElementById('analysis-results');
    
    button.disabled = true;
    progress.style.display = 'block';
    results.innerHTML = '';
    
    fetch('/run_analysis', { method: 'POST' })
        .then(response => response.json())
        .then(data => {
            progress.style.display = 'none';
            button.disabled = false;
            
            if (data.status === 'success') {
                results.innerHTML = `
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle"></i> Analysis completed successfully!
                    </div>
                    <pre class="bg-light p-3 rounded">${data.summary || 'Analysis completed'}</pre>
                `;
            } else {
                results.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-circle"></i> Analysis failed: ${data.message}
                    </div>
                `;
            }
        })
        .catch(error => {
            progress.style.display = 'none';
            button.disabled = false;
            results.innerHTML = `
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-circle"></i> Network error: ${error.message}
                </div>
            `;
        });
}
</script>
{% endblock %}